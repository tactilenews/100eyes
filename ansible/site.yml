---
- hosts: webservers
  become: yes
  vars:
    create_password: "{{ vps.sudo_password }}"
    copy_additional_keys: "{{ webservers.authorized_keys }}"
    sysctl_overwrite:
      # Enable IPv4 traffic forwarding.
      # See: https://github.com/dev-sec/ansible-os-hardening/tree/master/roles/os_hardening#docker-support
      net.ipv4.ip_forward: 1
  collections:
    - devsec.hardening
  roles:
    - role: devsec.hardening.ssh_hardening
      vars:
        network_ipv6_enable: false
    - role: devsec.hardening.os_hardening
      vars:
        ufw_enable_ipv6: false
    - role: initial_setup
    - role: gantsign.inotify
      inotify_max_user_watches: 524288
    - role: geerlingguy.pip
      vars:
        pip_install_packages:
          - name: docker
          - name: docker-compose
          - name: passlib
    - role: geerlingguy.docker
      vars:
        docker_compose_version: "1.27.4"
        docker_users:
          - ansible
    - role: installation
      tags:
        - hundred-eyes
